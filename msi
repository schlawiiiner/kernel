Check the Message Control Register:

    At offset 0x02 in the MSI capability structure, the Message Control register defines how MSI is configured.
    This register provides information on how many MSI vectors are supported and whether the device is capable of 64-bit message addressing.

Key fields in Message Control:

    Bits 3:1: Number of MSI vectors supported (minus one). For example, if these bits are 000, only one vector is supported.
    Bit 7: MSI Enable bit. This bit needs to be set (1) to enable MSI.
    Bit 8: 64-bit address capable. If set, the device can use a 64-bit address for the MSI message.

Write the MSI Message Address and Data:

    You must provide the device with the MSI message address and MSI message data.
    The MSI message address is the location in memory where the device will write the interrupt notification.
        On x86 systems, the MSI message address typically points to the Local APIC address (0xFEE0_0000).
        The MSI message data is the interrupt vector that corresponds to the interrupt you want the device to trigger.

The general steps for setting the address and data:

    Message Address (offset 0x04): Write the lower 32 bits of the MSI message address.
    Message Address High (offset 0x0C, optional): If the device supports 64-bit addressing (check Message Control bit 8), also write the upper 32 bits.
    Message Data (offset 0x08 or 0x0A): Write the interrupt vector number that will be triggered by MSI.

Enable MSI in the Message Control Register:

    Once the Message Address and Message Data are set, you can enable MSI by setting the MSI Enable bit (bit 0) in the Message Control register (offset 0x02).
    Write this value back to the Message Control register to enable MSI.